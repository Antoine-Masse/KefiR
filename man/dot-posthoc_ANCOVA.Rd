% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sys_posthoc_ANCOVA.R
\name{.posthoc_ANCOVA}
\alias{.posthoc_ANCOVA}
\title{Post-hoc comparisons for ANCOVA (Analysis of Covariance)}
\usage{
.posthoc_ANCOVA(
  ancova_model,
  factor_name = NULL,
  alpha = 0.05,
  method = "tukey",
  conf.level = 0.95,
  verbose = TRUE,
  debug = FALSE,
  code = FALSE,
  k = NULL
)
}
\arguments{
\item{ancova_model}{Object returned by \code{aov()} or \code{lm()} with ANCOVA formula.
Must include at least one factor and one numeric covariate.}

\item{factor_name}{Character. Name of the grouping factor for which to perform comparisons.
If NULL (default), uses the first factor in the model.}

\item{alpha}{Numeric. Significance level (default: 0.05).}

\item{method}{Character. Adjustment method for multiple comparisons:
\code{"tukey"} (default), \code{"bonferroni"}, \code{"holm"}, \code{"sidak"}, \code{"none"}.}

\item{conf.level}{Numeric. Confidence level for confidence intervals (default: 0.95).}

\item{verbose}{Logical. If TRUE, display pedagogical messages (default: TRUE).}

\item{debug}{Logical. If TRUE, display debugging messages (default: FALSE).}

\item{code}{Logical. If TRUE, display reproducible R code (default: FALSE).}

\item{k}{Integer or NULL. Message counter for .vbse() (internal use).}
}
\value{
A list of class \code{"posthoc"} containing:
\itemize{
\item \code{groups}: data.frame with group names and compact letter display
\item \code{adjusted_means}: data.frame with adjusted means and standard errors
\item \code{pairwise_comparisons}: data.frame with all pairwise comparisons
\item \code{p.value}: matrix of pairwise p-values
\item \code{method}: character string describing the adjustment method used
\item \code{note}: additional notes or warnings
}
}
\description{
Performs appropriate post-hoc pairwise comparisons following a significant ANCOVA,
using estimated marginal means (EMMs) adjusted for covariates. This function follows
academic best practices by:
\itemize{
\item Computing adjusted means at covariate mean values
\item Performing pairwise comparisons of adjusted means
\item Applying appropriate corrections for multiple comparisons
\item Providing compact letter display for group differences
}
}
\details{
\strong{Academic Rationale:}

After a significant ANCOVA, post-hoc comparisons should NOT be performed on raw group means,
but on \strong{adjusted means} (also called least-squares means or estimated marginal means).
These adjusted means represent the expected response for each group when all covariates
are held at their mean values.

\strong{Why adjusted means?}
\enumerate{
\item Raw group means are confounded by covariate differences between groups
\item ANCOVA removes covariate effects; post-hocs should reflect this adjustment
\item Adjusted means provide fair comparisons controlling for covariate influence
}

\strong{Recommended Methods:}
\itemize{
\item \strong{Tukey HSD} (default): Controls familywise error rate, assumes equal variances
\item \strong{Bonferroni}: More conservative, suitable for few comparisons
\item \strong{Holm}: Sequential Bonferroni, more powerful
\item \strong{Sidak}: Similar to Bonferroni but less conservative
}

\strong{When homoscedasticity is violated:}
Games-Howell test on residuals (experimental feature, use with caution).
}
\examples{
\dontrun{
# Example: Effect of treatment on weight, controlling for baseline weight
set.seed(123)
n <- 60
baseline_weight <- rnorm(n, 70, 10)
treatment <- factor(rep(c("Control", "Drug_A", "Drug_B"), each = 20))
# Treatment effect + covariate effect
final_weight <- 50 + 0.6 * baseline_weight +
                5 * (treatment == "Drug_A") +
                10 * (treatment == "Drug_B") +
                rnorm(n, 0, 3)

# ANCOVA
ancova_model <- aov(final_weight ~ treatment + baseline_weight)

# Post-hoc comparisons on adjusted means
posthoc_results <- .posthoc_ANCOVA(ancova_model,
                                   factor_name = "treatment",
                                   alpha = 0.05,
                                   method = "tukey",
                                   verbose = TRUE)
print(posthoc_results)
}

}
\references{
\itemize{
\item Maxwell, S. E., Delaney, H. D., & Kelley, K. (2018). \emph{Designing Experiments
and Analyzing Data: A Model Comparison Perspective} (3rd ed.). Routledge. Chapter 9 (ANCOVA).
ISBN: 978-1138892286
\item Huitema, B. E. (2011). \emph{The Analysis of Covariance and Alternatives:
Statistical Methods for Experiments, Quasi-Experiments, and Single-Case Studies}
(2nd ed.). Wiley. DOI: 10.1002/9781118067475
\item Rutherford, A. (2011). \emph{ANOVA and ANCOVA: A GLM Approach} (2nd ed.). Wiley.
ISBN: 978-0470385555
\item Searle, S. R., Speed, F. M., & Milliken, G. A. (1980). Population marginal means
in the linear model: An alternative to least squares means. \emph{The American
Statistician}, 34(4), 216-221. DOI: 10.1080/00031305.1980.10483031
}
}
\seealso{
\code{\link[emmeans]{emmeans}}, \code{\link[emmeans]{contrast}},
\code{\link{.posthoc}}, \code{\link{.posthoc_MANOVA}}
}
\keyword{internal}
