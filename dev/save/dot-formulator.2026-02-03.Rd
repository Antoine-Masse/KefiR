% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sys_formulator.R
\name{.formulator}
\alias{.formulator}
\title{Génère ou adapte une formule R pour différents types de modèles (ANOVA, Friedman, aovp, etc.)}
\usage{
.formulator(
  formula,
  mode = c("aov", "friedman", "aovp", "linear", "simple", "lmer"),
  debug = FALSE,
  verbose = TRUE,
  return = TRUE
)
}
\arguments{
\item{formula}{Une formule R (e.g. \code{y ~ x1 + x2}), un objet \code{call} ou une chaîne de
caractères convertible en formule.}

\item{mode}{Chaîne de caractères. Indique le modèle visé parmi \code{"aov"} (modèle linéaire
ou ANOVA via \code{\link[stats]{aov}}), \code{"friedman"} (test de Friedman) ou \code{"aovp"}
(modèle permuté via \code{aovp} de \pkg{lmPerm}, par exemple).}

\item{debug}{Logique. \code{TRUE} pour afficher des messages de débogage détaillés,
\code{FALSE} sinon (par défaut).}

\item{verbose}{Logique. \code{TRUE} pour afficher des messages informatifs,
\code{FALSE} sinon (par défaut).}

\item{return}{Logique. \code{TRUE} pour renvoyer la formule, \code{FALSE} sinon (par défaut).}
}
\value{
Une nouvelle \code{\link[stats]{formula}} ajustée au \code{mode} sélectionné,
éventuellement avec une structure d'erreur ou des effets aléatoires transformés pour
convenir à \code{aov}.
}
\description{
La fonction \code{formulator} prend en entrée une \code{\link[stats]{formula}} (ou un objet
convertible en formule) ainsi qu'un mode de traitement \code{c("aov", "friedman", "aovp")}.
Elle renvoie une nouvelle formule adaptée au contexte du modèle choisi, en gérant notamment :
\itemize{
\item La présence éventuelle d'effets aléatoires de type \code{(1|random)} ou
\code{(var|random)}, qu'elle transforme en \code{Error(random)} ou
\code{Error(random/var)} pour \code{aov}.
\item La structure d'erreur explicite via \code{Error(...)}.
\item La détection de la barre verticale \code{|} pour séparer des prédicteurs
ou gérer des blocs (cas \code{friedman}).
}
}
\details{
\enumerate{
\item \strong{Conversion en formule} : si \code{formula} n'est pas déjà une formule,
la fonction tente de la convertir via \code{\link[base:as.formula]{as.formula}}.

\item \strong{Détection et transformation des effets aléatoires} :
\itemize{
\item Les syntaxes \code{(1|random)} ou \code{(X|random)} sont repérées.
\item Elles sont transformées en \code{Error(random)} ou \code{Error(random/X)}
afin d'être compatibles avec \code{\link[stats]{aov}}.
\item Si d'autres formes d'effets aléatoires (\code{|}) sont détectées en dehors
d'un contexte \code{aov}, un message d'erreur est levé (mode \code{friedman}
ou \code{aovp} ne les prenant pas en charge).
}

\item \strong{Gestion de la structure d'erreur} : si la formule comporte déjà un \code{Error(...)}
explicite, celui-ci est conservé et adapté selon le mode demandé (principalement \code{aov}).

\item \strong{Mode \code{friedman}} : pour un test de Friedman standard, on attend un seul prédicteur
répétable (\code{response ~ factor | bloc}). Ainsi, s'il y a plusieurs prédicteurs, la fonction
lève une erreur pour signaler l'usage non prévu de \code{friedman.test}.

\item \strong{Mode \code{aovp}} : similaire à \code{aov}, mais ne gère pas d'effets aléatoires via \code{|}.
Si \code{|} est détecté, on arrête la fonction et signale que l'utilisateur devrait recourir
à un modèle mixte ou à \code{aov} + \code{Error(...)}.
}
}
\examples{
\dontrun{
## Exemple 1 : Formule simple, mode "aov"
f <- formulator(y ~ x1 + x2, mode = "aov", debug = TRUE)
f

## Exemple 2 : Formule avec effets aléatoires, mode "aov"
# (1|Sujet) est transformé en Error(Sujet)
formulator(y ~ x1 + x2 + (1|Sujet), mode = "aov", debug = TRUE)

## Exemple 3 : Test de Friedman
# Doit être du type y ~ factor | bloc
#   => "bloc" ici est ajouté arbitrairement si la formule n'en contient qu'un prédicteur
formulator(y ~ traitement, mode = "friedman")

## Exemple 4 : "aovp" (modèle permuté)
# => Les effets aléatoires ne sont pas pris en charge
formulator(y ~ x1 + x2, mode = "aovp")
}

}
\seealso{
\itemize{
\item \code{\link[stats]{aov}} pour l'ANOVA classique,
\item \code{\link[stats]{friedman.test}} pour le test de Friedman,
\item \code{\link[lmPerm]{aovp}} pour l'ANOVA avec permutations (s'il est installé),
\item \code{\link[lme4]{lmer}} pour un modèle mixte prenant en charge les effets aléatoires.
}
}
