TODO LIST — audit m.test() / sys_multi_factor_analysis.R (2026-02-05)

Objectif
- Corriger la logique et l’affichage dans les branches « ANOVA robuste / permutation / post-hoc »
- Assurer cohérence des étapes (k), des messages, et du mode code=TRUE
- Garantir un retour de résultats (pas de NULL) après post-hoc

A) Logique de pipeline (fond)
1) Assomptions de base AVANT routage par déséquilibre
   - Afficher « ASSOMPTION DE BASE : indépendance des observations »
   - Exécuter diagnostic outliers (identify_outliers) avant toute décision de routage
   - Raison : nécessaire pour fixer le trimmage WRS2 et cohérence pédagogique

2) Seuils de déséquilibre (règle générale, pas un exemple)
   - ratio <= 2 : ANOVA classique (type I/III)
   - 2 < ratio <= 10 : ANOVA robuste par permutation (lmPerm::aovp)
   - ratio > 10 : bascule vers WRS2 (t2way pour 2 facteurs, t3way pour 3+)
   - Trimmage : 20% si outliers/extremes détectés, sinon 0%

3) ANOVA par permutation — affichage
   - Supprimer le “blabla” explicatif avant le tableau
   - Afficher directement le tableau ANOVA (summary aovp)

4) Contrôle post-hoc après ANOVA robuste
   - Étape dédiée (pas “ASSOMPTION x/3”) :
     "Contrôle d’adéquation des post-hocs après ANOVA robuste"
   - Contenu en 2 sous-parties :
     a) Normalité (via .normality)
     b) Variance (via .variance)
   - Si outliers détectés : forcer post-hocs robustes/trim même si variance OK
   - Ne pas relancer ces tests si déjà faits en amont

B) Bugs et cohérence sortie
5) Post-hocs qui finissent en NULL
   - Identifier où “valeur manquante là où TRUE/FALSE requis” se produit
   - Corriger pour renvoyer un objet posthoc valide (pas NULL)

6) Messages “post-hoc sur groupes normaux”
   - Doivent dépendre des résultats réels de normalité + variance
   - Si non-normalité ou variance hétérogène : post-hocs non paramétriques

7) Numérotation k et labels
   - Vérifier incréments k dans tous les nouveaux chemins
   - “ASSOMPTION DE BASE” doit incrémenter k sans interférer avec 1/3, 2/3, 3/3

8) Mode code=TRUE
   - Ajouter .code_multi pour chaque nouvelle étape introduite
   - Éviter les doublons si les tests ont déjà été faits

C) Fichiers impactés (prévision)
- R/sys_multi_factor_analysis.R (principal)
- R/sys_posthoc.R (erreur TRUE/FALSE + retour NULL)
- R/print_methods.R (formatage si nécessaire)
- R/sys_one_factor_analysis.R (si partage logique post-hoc)

Prochaine étape
- Démarrer les modifications en s’appuyant sur ce log + bp.log
- Revenir vers l’utilisateur après chaque bloc majeur (routage, post-hoc, retour)
